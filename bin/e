#!/usr/bin/env bash

### Start/Attach emacs daemon

if [[ $(uname -s) == "Darwin" ]]; then
    EMACSCLIENT="reattach-to-user-namespace emacsclient"
else
    EMACSCLIENT="emacsclient"
fi

# Count available emacs frames
# If emacs daemon is not running, start it firstly
frame_count=$($EMACSCLIENT -a '' -e '(length (visible-frame-list))')

# Emacs daemon have invisible frame
if [[ $frame_count -lt 2 ]]; then
    # Open a new frame
    $EMACSCLIENT -nc "$@"
else
    # Attach existing frame
    $EMACSCLIENT -n "$@"
fi
