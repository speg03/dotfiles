#!/usr/bin/env bash
#
# Install my custom .emacs.d


### Checking require packages are installed

if ! type git &>/dev/null; then
    echo "!!! Require package: git "
    exit 1
fi


### Download dotemacs

dotemacs_path=$HOME/.local/src/github.com/speg03/dotemacs
if [[ ! -e $dotemacs_path ]]; then
    echo -n "Downloading dotemacs ... "
    git clone -q https://github.com/speg03/dotemacs "$dotemacs_path"
    echo "Done."
fi


### Create symlinks

symlink() {
    local src_path=$1
    local dst_path=$2

    if [[ ! -h $dst_path && -e $dst_path ]]; then
        # 宛先がシンボリックリンク以外で存在する場合
        echo "$(basename "$dst_path") already exists."
    elif [[ ! -e $dst_path ]]; then
        # 宛先が存在しない場合
        # またはシンボリックリンクでそのリンク先が存在しない場合
        echo -n "Creating link $(basename "$dst_path") ... "
        mkdir -p "$(dirname "$dst_path")"
        ln -snf "$src_path" "$dst_path"
        echo "Done."
    fi
    # 宛先がシンボリックリンクとして存在した場合は何もしない
}

symlink "$dotemacs_path" "$HOME/.emacs.d"
